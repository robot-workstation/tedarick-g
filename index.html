<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Compel ⇄ Products (Tek Robot)</title>
  <style>
    :root{color-scheme:dark}
    html,body{height:100%}
    body{
      margin:0;height:100vh;overflow:hidden;display:flex;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:#0b0d12;color:#eaeef7;font-size:15px
    }

    /* LAYOUT */
    .layout{
      flex:1;min-height:0;overflow:hidden;display:grid;
      grid-template-columns:460px 1fr;
    }
    aside{
      border-right:1px solid #1f2430;
      padding:8px;
      overflow:hidden;
      display:flex;
      flex-direction:column;
      min-height:0;
      gap:8px;
      background:#0b0d12;
    }
    section.maincol{
      min-height:0;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }

    /* ASIDE (MARKA SEÇİMİ) */
    .btnrow{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
    button,.file{
      background:#111827;color:#eaeef7;border:1px solid #2a3140;border-radius:10px;
      font-weight:900;font-size:14px;height:36px;display:flex;align-items:center;justify-content:center;line-height:1
    }
    button{padding:0 12px;cursor:pointer}
    button:hover,.file:hover{background:#1f2a44;border-color:#6b7da6}
    button:disabled{opacity:.55;cursor:not-allowed}
    button:disabled:hover{background:#111827;border-color:#2a3140}

    .ibox{
      min-height:36px;
      display:flex;align-items:center;flex-wrap:wrap;gap:6px;
      padding:8px 10px;border:1px solid #1f2430;border-radius:12px;background:#0f1320
    }
    .chip{
      padding:3px 9px;border:1px solid #2a3140;border-radius:999px;background:#0b0d12;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      font-weight:1000;font-size:14px;line-height:1.1
    }
    .chip.ok{color:#86efac}.chip.bad{color:#fca5a5}.chip.unk{color:#fcd34d}.chip.muted{opacity:.88;font-weight:900}

    .brandList{
      flex:1;min-height:0;overflow:auto;
      display:grid;grid-template-columns:repeat(2,1fr);gap:6px 10px;align-content:start
    }
    .brand{
      display:flex;align-items:center;
      padding:7px 10px;border:1px solid #1f2430;border-radius:12px;background:#0f1320;
      cursor:pointer;user-select:none;min-width:0
    }
    .brand:hover{border-color:#2a3140}
    .brand.sel{background:#1f2a44;border-color:#6b7da6}
    .bRow{display:grid;grid-template-columns:28px 1fr auto;gap:6px;align-items:center;min-width:0;width:100%}
    .bIdx{font-variant-numeric:tabular-nums;opacity:.9;white-space:nowrap}
    .bNm{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-weight:1100;font-size:15px;line-height:1.2}
    .bCt{white-space:nowrap;opacity:.9;font-size:11px}

    /* TOPBAR (DOSYALAR + LİSTELE) */
    .topbar{padding:8px;border-bottom:1px solid #1f2430;background:#0b0d12;flex:0 0 auto}
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:flex-start}
    .sep{width:8px;flex:0 0 auto}.sepSm{width:6px;flex:0 0 auto}
    .file{
      justify-content:flex-start;gap:8px;padding:0 10px;user-select:none;cursor:pointer;max-width:520px
    }
    .file input{display:none}
    .fbtn{white-space:nowrap}
    .fname{
      font-weight:800;opacity:.92;font-size:14px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:170px
    }
    #infoBox{margin-left:auto}

    /* PANELLER */
    .panel{padding:8px;min-height:0;display:flex;flex-direction:column;gap:6px;overflow:hidden}
    .results{flex:2 1 0}
    .unmatched{flex:1 1 0}
    .tableWrap{flex:1;min-height:0;overflow-y:auto;overflow-x:hidden;border:1px solid #1f2430;border-radius:12px;background:#0f1320}
    table{width:100%;border-collapse:collapse;table-layout:fixed}
    th,td{border-bottom:1px solid #1f2430;padding:9px 6px;text-align:center;vertical-align:middle;font-size:14px;line-height:1.1}
    td{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    th{position:sticky;top:0;z-index:2;background:#0b0d12;font-weight:1100;white-space:nowrap;overflow:hidden;text-overflow:clip;padding:7px 6px}
    .hTxt{display:inline-block;white-space:nowrap;transform-origin:left center;will-change:transform}
    tbody tr:hover{background:#111827}
    .left{text-align:left!important}
    .hMain{font-weight:1100}
    .hParen{font-size:12px;font-weight:400;opacity:.9}

    .cellTxt{display:inline-block}
    td.nameCell{overflow:visible;text-overflow:clip;position:relative;z-index:1}
    td.nameCell .nm{display:inline-block;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:9999px;position:relative;z-index:3}
    td.eanCell{overflow:visible;text-overflow:clip}
    td.seqCell{font-weight:1100}
    td.statusBold{font-weight:1100}
    a{color:#93c5fd;text-decoration:none}
    a:hover{text-decoration:underline}

    input[type=text]{
      width:100%;min-width:78px;box-sizing:border-box;height:36px;
      background:#111827;color:#eaeef7;border:1px solid #2a3140;border-radius:10px;
      padding:0 10px;font-weight:900;font-size:14px;line-height:1;display:flex;align-items:center
    }
    input[type=text]:focus{outline:none;border-color:#6b7da6}

    @media (max-width:1100px){
      .layout{grid-template-columns:1fr}
      aside{border-right:0;border-bottom:1px solid #1f2430}
      .brandList{grid-template-columns:1fr}
      th{position:static}
    }
    @media (max-width:980px){.fname{max-width:130px}}

    /* Depo modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:50;padding:18px}
    .modalInner{width:min(980px,100%);background:#0f1320;border:1px solid #2a3140;border-radius:14px;box-shadow:0 12px 40px rgba(0,0,0,.55);padding:12px;display:flex;flex-direction:column;gap:10px}
    .modalHdr{font-weight:1100;font-size:16px}
    .modal textarea{width:100%;height:260px;resize:vertical;box-sizing:border-box;background:#0b0d12;color:#eaeef7;border:1px solid #2a3140;border-radius:12px;padding:10px;font-weight:800;font-size:14px}
    .modalBtns{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .modalHint{opacity:.85;font-size:13px;line-height:1.35}
  </style>
</head>

<body>
  <main class="layout">

    <!-- SOL: MARKA SEÇİMİ -->
    <aside>
      <div class="btnrow">
        <button id="btnAll" type="button">Tümünü Seç</button>
        <button id="btnNone" type="button">Temizle</button>
      </div>

      <div class="ibox" id="brandInfo">
        <span class="chip muted" id="brandStatus">Markalar yükleniyor…</span>
      </div>

      <div class="brandList" id="brandList"></div>
    </aside>

    <!-- SAĞ: ROBOT 1 EŞLEŞTİRME -->
    <section class="maincol">
      <header class="topbar">
        <div class="controls">
          <label class="file" title="Sescibaba Stok (CSV)">
            <span class="fbtn">Sescibaba Stok</span>
            <span class="fname" id="n2">Yükle</span>
            <input id="f2" type="file" accept=".csv,text/csv">
          </label>

          <!-- Depo: yapıştırma -->
          <button id="depoBtn" class="file" type="button" title="Depo Stok Yapıştır">
            <span class="fbtn">Depo Stok</span><span class="fname" id="n4">Yükle</span>
          </button>

          <label class="file" title="JSON Map">
            <span class="fbtn">JSON Map</span>
            <span class="fname" id="n3">Yükle</span>
            <input id="f3" type="file" accept=".json,application/json">
          </label>

          <span class="sep"></span>

          <button id="go" title="Listele">Listele</button>
          <button id="stop" title="Durdur" disabled>Durdur</button>

          <span class="sepSm"></span>

          <button id="dl1" disabled>CSV Çıktı</button>
          <button id="dl2" disabled style="display:none">Eşleşmeyen CSV</button>
          <button id="dl3" disabled>JSON Çıktı</button>

          <div class="ibox" id="infoBox">
            <span class="chip ok" id="stChip">Hazır</span>
            <span class="chip muted" id="selChip">Seçili 0</span>
            <span class="chip" id="l1Chip">L1:-</span>
            <span class="chip" id="l2Chip">L2:-</span>
            <span class="chip" id="l4Chip">L4:-</span>
            <span class="chip muted" id="sum">Toplam 0 • ✓0 • ✕0</span>
            <span class="chip muted" id="jsonChip" style="display:none"></span>
          </div>
        </div>
      </header>

      <section class="panel results">
        <div class="tableWrap"><table id="t1"></table></div>
      </section>

      <section class="panel unmatched" id="unmatchedSection" style="display:none">
        <div class="tableWrap"><table id="t2"></table></div>
      </section>
    </section>
  </main>

  <!-- Depo Yapıştırma Modal -->
  <div class="modal" id="depoModal" aria-hidden="true">
    <div class="modalInner">
      <div class="modalHdr">Depo Stok Yapıştır</div>
      <textarea id="depoPaste" placeholder="Buraya yapıştır... (tablo/CSV)"></textarea>
      <div class="modalBtns">
        <button id="depoClear" type="button">Temizle</button>
        <button id="depoClose" type="button">Kapat</button>
        <button id="depoLoad" type="button">Yükle</button>
      </div>
      <div class="modalHint">
        Kopyaladığın metni yapıştırabilirsin. Tab / ; / , ayracı otomatik algılanır.
        “Stok Kodu” alanı, Sescibaba “Tedarikçi Ürün Kodu” ile eşleştirilir.
      </div>
    </div>
  </div>

  <datalist id="wsCodes"></datalist>
  <datalist id="supCodes"></datalist>

  <script type="module" src="./js/app.js"></script>
</body>
</html>
